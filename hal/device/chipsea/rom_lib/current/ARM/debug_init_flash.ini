
// 1: ROM
// 2: RAM
FUNC void remap (int m) 
{
    _WDWORD(0x400e003c, _RDWORD(0x400e003c) | (1<<5));
    _WDWORD(0x400e003c, (_RDWORD(0x400e003c) & 0xfffffff0) | m | (1<<5));
}

// Disable WDT
_WDWORD(0x400e00e8, 0x6666);

// Reset pinmux
_WDWORD(0x40000080, 0x00000000);
_WDWORD(0x40000084, 0x00000000);
_WDWORD(0x40000088, 0x00001c00);
_WDWORD(0x4000008C, 0x00000000);
_WDWORD(0x40000090, 0x00000000);
_WDWORD(0x40000094, 0x00000000);
_WDWORD(0x40000098, 0x00000000);

// Disable All IRQ
_WDWORD(0xE000E180, 0xFFFFFFFF);
_WDWORD(0xE000E184, 0xFFFFFFFF);
_WDWORD(0xE000E010, 0);

// Invalid Cache
_WDWORD(0xE0042004, 1);
_WDWORD(0xE0042008, 0);
_WDWORD(0xE0042020, 1);
_WDWORD(0xE0042004, 0);
_WDWORD(0xE0042008, 1);

// Remap
//remap(2);

// Load code
LOAD ..\..\..\hal\device\chipsea\rom_lib\current\misc\ram_resident_data_by_rcs.hex INCREMENTAL;
LOAD %L INCREMENTAL NOCODE;

// New SP/PC
SP = _RDWORD(0x50004000);
PC = _RDWORD(0x50004004);

// On Reset
FUNC void OnResetExec(void)
{
    // Invalid Cache
    _WDWORD(0xE0042004, 1);
    _WDWORD(0xE0042008, 0);
    _WDWORD(0xE0042020, 1);
    _WDWORD(0xE0042004, 0);
    _WDWORD(0xE0042008, 1);

    exec("LOAD ..\\..\\..\\hal\\device\\chipsea\\rom_lib\\current\\misc\\ram_resident_data_by_rcs.hex INCREMENTAL;");
    exec("LOAD %L INCREMENTAL NOCODE;");

    // New SP/PC
    exec("SP = _RDWORD(0x50004000);");
    exec("PC = _RDWORD(0x50004004);");
}

